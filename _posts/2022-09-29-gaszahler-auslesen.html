---
layout: post
title: Gaszähler G4 RF1 auslesen mit Aqara Sensor
date: 2022-09-29 22:10:54.000000000 +02:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Blog
- HomeAssistant
tags:
- 3D Printer
- Aqara
- Aqara Sensor
- Gaszähler
- IoT
- Tinkercad
meta:
  rank_math_internal_links_processed: '1'
  rank_math_seo_score: '86'
  rank_math_primary_category: '89'
  rank_math_focus_keyword: Gaszähler
  _edit_last: '1'
  _ez-toc-disabled: ''
  _ez-toc-insert: ''
  _ez-toc-heading-levels: a:0:{}
  _ez-toc-alttext: ''
  _ez-toc-exclude: ''
  rank_math_og_content_image: a:2:{s:5:"check";s:32:"71e1396acab23de82471974d4e82f373";s:6:"images";a:1:{i:0;s:71:"https://affengriff.net/wp-content/uploads/2022/09/IMG_1410-768x1024.jpg";}}
author:
  login: smon
  email: simon_eisele@web.de
  display_name: Simon Eisele
  first_name: Simon
  last_name: Eisele
permalink: "/2022/09/29/gaszahler-auslesen/"
---
<p><!-- wp:paragraph --></p>
<p>Mit der Hilfe eines Aqara Tür und Fenster Sensors ( Reed Kontakt Sensor ) kann am Gaszähler ( G4 RF1) über den Internen Magneten der aktuelle Verbrauch abgelesen werden ( 1 Imp = 0.1m³ ). Eingebunden ist das ganze wie bereits beim&nbsp;<a href="https://affengriff.net/2021/10/26/esp8266-stromzahler-auslesen/" target="_blank" rel="noreferrer noopener">digitalen Stromzähler</a>&nbsp;in Home Assistant ( HASSIO ). Dort kann man sich die Verbrauchswerte für die unterschiedliche Zeiten (Tag, Woche, Monat, Jahr) anzeigen lassen.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:heading --></p>
<h2 id="benotigte-hardware"><strong>Benötigte Hardware</strong></h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:list --></p>
<ul><!-- wp:list-item --></p>
<li><a href="https://www.amazon.de/Aqara-MCCGQ11LM-Window-Sensor-Fensterssensor/dp/B07D37VDM3" target="_blank" rel="noreferrer noopener">Aqara Tür- und Fenstersensor</a></li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li><a href="https://affengriff.net/category/3d-prints/" target="_blank" rel="noreferrer noopener">3D Drucker&nbsp;</a></li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Gaszähler G4 RF1</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Zigbee USB Stick (ConBee2 <strong>||</strong> SkyConnect)</li>
<p><!-- /wp:list-item --></ul>
<p><!-- /wp:list --></p>
<p><!-- wp:heading --></p>
<h2 id="benotigte-software"><strong>Benötigte Software</strong></h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:list --></p>
<ul><!-- wp:list-item --></p>
<li><a href="https://www.tinkercad.com" target="_blank" rel="noreferrer noopener">TinkerCad</a></li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li><a href="https://www.prusa3d.de" target="_blank" rel="noreferrer noopener">PrusaSlicer</a></li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li><a href="https://www.home-assistant.io/getting-started/" target="_blank" rel="noreferrer noopener">Home Assistant</a></li>
<p><!-- /wp:list-item --></ul>
<p><!-- /wp:list --></p>
<p><!-- wp:heading --></p>
<h2 id="3d-gehause-tinkercad"><strong>3D Gehäuse Tinkercad</strong></h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:list --></p>
<ul><!-- wp:list-item --></p>
<li><a href="https://www.tinkercad.com/things/9ECOQKcssap" target="_blank" rel="noreferrer noopener">Gaszähler Aqara G4 RF1</a></li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li><a href="https://www.tinkercad.com/things/9uSG6HJZTm5" target="_blank" rel="noreferrer noopener">Gaszähler Aqara Cap</a></li>
<p><!-- /wp:list-item --></ul>
<p><!-- /wp:list --></p>
<p><!-- wp:heading --></p>
<h2><strong>Aufbau</strong></h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:gallery {"linkTo":"none"} --></p>
<figure class="wp-block-gallery has-nested-images columns-default is-cropped"><!-- wp:image {"id":1109,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image size-large"><img src="{{ site.baseurl }}/assets/2022/09/IMG_1410-768x1024.jpg" alt="Aqara Tür Fenster Sensor<br />
" class="wp-image-1109" /></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:image {"id":1108,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image size-large"><img src="{{ site.baseurl }}/assets/2022/09/IMG_1411-768x1024.jpg" alt="3D Printer Case<br />
" class="wp-image-1108" /></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:image {"id":1110,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image size-large"><img src="{{ site.baseurl }}/assets/2022/09/IMG_1412-scaled.jpg" alt="" class="wp-image-1110" /></figure>
<p><!-- /wp:image --></figure>
<p><!-- /wp:gallery --></p>
<p><!-- wp:heading --></p>
<h2><strong>Gaszähler&nbsp;Typ&nbsp;G4 RF1</strong></h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:media-text {"mediaId":1107,"mediaLink":"https://affengriff.net/?attachment_id=1107","mediaType":"image","mediaWidth":30} --></p>
<div class="wp-block-media-text alignwide is-stacked-on-mobile" style="grid-template-columns:30% auto">
<figure class="wp-block-media-text__media"><img src="{{ site.baseurl }}/assets/2022/09/IMG_1413-768x1024.jpg" alt="Gaszähler G4 RF1" class="wp-image-1107 size-full" /></figure>
<div class="wp-block-media-text__content"><!-- wp:paragraph --></p>
<p>Bei meinem Gaszähler handelt es sich um das Model G4 RF1 von Actaris.&nbsp;</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Das Model G4 RF1 von Pipersberg ist baugleich soweit ich weiß. Daher sollte das Case für den Sensor auch hier passen.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Der Magnet befindet sich hinter der ersten roten Zahl nach dem Komma ( 1imp = 0.1m³ ).</p>
<p><!-- /wp:paragraph --></div>
</div>
<p><!-- /wp:media-text --></p>
<p><!-- wp:heading --></p>
<h2><strong>Hassio configuration.yaml</strong></h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:code --></p>
<pre class="wp-block-code"><code># GASTZÄHLER      
counter:
    gaszaehler:
      initial: 0
      step: 1
      icon: mdi:meter-gas-outline 
# CAN ALSO BE ADDED TO Automation.yaml
automation:
# COUNTER INCREMENT 
- id: '1664298491581'
  alias: increaseCounter
  description: ''
  trigger:
  - type: turned_off
    platform: device
    device_id: c0d6f8ef97c5bffd76e0be955598bcfc
    entity_id: binary_sensor.openclose_8
    domain: binary_sensor
    for:
      hours: 0
      minutes: 0
      seconds: 0
  condition: &#91;]
  action:
  - service: counter.increment
    data: {}
    target:
      entity_id: counter.gaszaehler
  mode: single
# COUNTER RESET AT MIDNIGHT
- id: '1664298606458'
  alias: counterReset
  description: ''
  trigger:
  - platform: time
    at: 00:00:00
  condition: &#91;]
  action:
  - service: counter.reset
    data: {}
    target:
      entity_id: counter.gaszaehler
  mode: single 
# VIRTUAL SENSOR 
template:
  - sensor:
      - name: "Gaszaehler_m3"
        unit_of_measurement: "m³"
        device_class: energy
        state_class: total_increasing
        state: &gt;
          {% set gas = states('counter.gaszaehler') | int %}
          {{ ((gas) * 0.1) | round(1, default=0) }}
  - sensor:
      - name: "Gaszaehler_kWh"
        unit_of_measurement: "kWh"
        device_class: energy
        state_class: total_increasing
        state: &gt;
          {% set kwh = states('sensor.gaszaehler_m3') | float %}
          {{ ((kwh) * 10.5) | round(1, default=0) }}

# 10.5 NEEDS TO BE CHECKED AT YOUR GAS INVOICE ( Z-ZAHL )
# 11.404 Laut meiner Rechnung der Stadtwerke!</code></pre>
<p><!-- /wp:code --></p>
<p><!-- wp:heading --></p>
<h2><strong>Home Assistant grafische Darstellung</strong></h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:gallery {"linkTo":"none"} --></p>
<figure class="wp-block-gallery has-nested-images columns-default is-cropped"><!-- wp:image {"id":2177,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image size-large"><img src="{{ site.baseurl }}/assets/2022/09/Bildschirmfoto-2022-12-16-um-08.12.06.png" alt="" class="wp-image-2177" /></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:image {"id":2179,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image size-large"><img src="{{ site.baseurl }}/assets/2022/09/Bildschirmfoto-2022-12-16-um-08.13.08.png" alt="" class="wp-image-2179" /></figure>
<p><!-- /wp:image --></figure>
<p><!-- /wp:gallery --></p>
<p><!-- wp:heading --></p>
<h2><strong>Zigbee USB-Gateway Deconz - ConBeeII </strong></h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>Der Aqara Tür und Fenster Sensors ist über Zigbee mit HomeAssistant connected. Dazu muss der Aqara Sensor mit dem USB-Gateway connected werden. </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:media-text {"mediaId":2183,"mediaLink":"https://affengriff.net/2022/09/29/gaszahler-auslesen/bildschirmfoto-2022-12-16-um-08-23-08/#main","mediaType":"image","mediaWidth":43} --></p>
<div class="wp-block-media-text alignwide is-stacked-on-mobile" style="grid-template-columns:43% auto">
<figure class="wp-block-media-text__media"><img src="{{ site.baseurl }}/assets/2022/09/Bildschirmfoto-2022-12-16-um-08.23.08-1024x455.png" alt="" class="wp-image-2183 size-full" /></figure>
<div class="wp-block-media-text__content"><!-- wp:list --></p>
<ul><!-- wp:list-item --></p>
<li>Gehen Sie im Abschnitt Geräte auf Sensoren.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Drücke Sie Neuen Sensor Verbinden.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Wählen Sie „Andere“ als Anbieter aus</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Sensor-Suche ist jetzt für 3 Minuten aktiv.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Drücken Sie kurz die kleine Taste am Sensor.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Bei Problemen, nähern Sie sich dem ConBee II und drücken Sie die Taste erneut.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Sensor umbenennen. </li>
<p><!-- /wp:list-item --></ul>
<p><!-- /wp:list --></div>
</div>
<p><!-- /wp:media-text --></p>
<p><!-- wp:heading --></p>
<h2><strong>Deconz Geräteübersicht</strong></h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>Hier sind alle devices aufgelistet. In meinem Fall hatte ich Probleme eine gute Verbindung im gesamten Haus zu bekommen. Für eine bessere Abdeckung habe ich zwei IKEA TRÅDFRI  Signalverstärker in den Stockwerken verbaut. </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":2184,"sizeSlug":"full","linkDestination":"none"} --></p>
<figure class="wp-block-image size-full"><img src="{{ site.baseurl }}/assets/2022/09/Bildschirmfoto-2022-12-16-um-08.33.35.png" alt="" class="wp-image-2184" /></figure>
<p><!-- /wp:image --></p>
<p><!-- wp:heading --></p>
<h2>Der neue SkyConnect von HomeAssistant ist endlich da!</h2>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>Da ich einen Raspberry Pi 4 verwende kann ich auf den SkyConnect Matter Stick umsteigen der von HomeAssistant vertrieben wird. Ich habe mir aktuell noch keinen HomeAssistant Yellow bestellt, mal schauen ob ich das noch machen werde. Aber aktuell sind die Lieferzeiten utopisch. Vor allem bekommt man kein Raspberry Pi Compute Modul zu normalen Preisen. </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Jetzt muss ich leider alle Zigbee Devices mit dem SkyConnect Stick neu connecten. </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:image {"id":2185,"sizeSlug":"large","linkDestination":"none"} --></p>
<figure class="wp-block-image size-large"><img src="{{ site.baseurl }}/assets/2022/09/Bildschirmfoto-2022-12-16-um-08.39.48-625x1024.png" alt="" class="wp-image-2185" /></figure>
<p><!-- /wp:image --></p>
